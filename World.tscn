[gd_scene load_steps=8 format=2]

[ext_resource path="res://Boid.tscn" type="PackedScene" id=1]
[ext_resource path="res://World.gd" type="Script" id=2]
[ext_resource path="res://ColorRect.gd" type="Script" id=3]

[sub_resource type="Shader" id=1]
code = "shader_type canvas_item;

uniform sampler2D noise;
uniform float cloud_coverage : hint_range(0.0, 1.0);
uniform float cloud_intensity : hint_range(0.0, 2.0);
uniform float offset_x = 0;
uniform float offset_y = 0;

uniform vec4 cloud_color : hint_color;
uniform vec4 day_bottom_color : hint_color = vec4(0.4, 1.0, 1.0, 1.0);
uniform vec4 day_top_color : hint_color = vec4(0.0, 0.8, 1.0, 1.0);
uniform float horizon_band : hint_range(0.0, 1.0);
uniform float horizon_smoothing : hint_range(-16.0, 16.0);

uniform float speed : hint_range(0.0, 1.0);
uniform float fluffiness : hint_range(0.0, 2.0);

void fragment(){
	vec4 screen_color = texture(SCREEN_TEXTURE, SCREEN_UV);
	vec4 noise1 = texture(noise, mod(UV + TIME * 2.5 * speed / 10.0, 0.0));
	vec4 noise2 = texture(noise, mod(UV + TIME * (2.5 + fluffiness * 3.0) * speed / 10.0, 0.0));
	vec4 noise_color = noise1 + noise2;
	//vec4 noise_color = texture(noise, vec2(UV.x / 2.0 + offset_x, UV.y + offset_y));
//	noise_color.rgb = smoothstep(
//		vec3(1.0 - cloud_coverage),
//		vec3(1.0 - cloud_intensity),
//		noise_color.rgb
//
//	) * 2.0;
	noise_color.rgb = smoothstep(cloud_intensity - 0.3, cloud_intensity + 0.3, noise_color).rgb;
	
//	noise_color.rgb += step(
//		vec3(cloud_intensity),
//		noise_color.rgb
//	);
	vec3 sky_color = mix(day_bottom_color.rgb, day_top_color.rgb, clamp(smoothstep(0.0, 1.0, 1.0-UV.y + horizon_band / horizon_smoothing), 0.0, 1.0));
	
	COLOR = mix(vec4(sky_color, 1.0), vec4(mix(noise_color.rgb, cloud_color.rgb, 1.0), noise_color.a), noise_color.r);
}"

[sub_resource type="OpenSimplexNoise" id=3]
octaves = 6
period = 147.2
persistence = 0.549
lacunarity = 1.53

[sub_resource type="NoiseTexture" id=4]
width = 640
height = 350
seamless = true
noise = SubResource( 3 )

[sub_resource type="ShaderMaterial" id=2]
shader = SubResource( 1 )
shader_param/cloud_coverage = 0.0
shader_param/cloud_intensity = 0.965
shader_param/offset_x = 0.0
shader_param/offset_y = 0.0
shader_param/cloud_color = Color( 0.760784, 0.752941, 0.698039, 1 )
shader_param/day_bottom_color = Color( 0.756863, 0.419608, 0.215686, 1 )
shader_param/day_top_color = Color( 0.658824, 0.321569, 0.513726, 1 )
shader_param/horizon_band = 0.448
shader_param/horizon_smoothing = 1.103
shader_param/speed = 0.115
shader_param/fluffiness = 1.173
shader_param/noise = SubResource( 4 )

[node name="World" type="Node2D"]
script = ExtResource( 2 )
x_size = 600
y_size = 340
boid_amount = 100

[node name="ColorRect" type="ColorRect" parent="."]
material = SubResource( 2 )
margin_right = 640.0
margin_bottom = 350.0
script = ExtResource( 3 )
__meta__ = {
"_edit_use_anchors_": false
}

[node name="Boid" parent="." instance=ExtResource( 1 )]
